#from vapour.strainer.functions import getShortFileName
<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
#from vapour.namespaces import EARL
#from vapour.teapot import mimetypes
  <head>
    <meta http-equiv="content-type" content="text/xhtml+xml; charset=utf-8" />
    #if len($testAgent) > 0:
    <meta name="generator" content="$testAgent[1] $testAgent[2] (${testAgent[3]})" />
	#end if
    #if len($testRequirements) > 0:
	    #if $isThereAnyFailingTest:
    <link rel="shortcut icon" href="$resourceBaseUri/redFavicon.png" type="image/png" />
	    #else:
    <link rel="shortcut icon" href="$resourceBaseUri/greenFavicon.png" type="image/png" />
	    #end if
    #else:
    <link rel="shortcut icon" href="$resourceBaseUri/images/favicon.png" type="image/png" />
    #end if
    <meta name="description" content="An automatically-generated report of compliance with respect to the 'Best Practice Recipes for Publishing RDF vocabularies'" />
    <meta name="keywords" content="rdf, best practice, recipes, semantic web" />
    <link type="text/css" rel="stylesheet" href="$resourceBaseUri/report-style.css" media="screen,projection,print" />
    <!--<link rel="alternate" type="application/rss+xml" title="RDF version of this report" href="FIXME" />-->
    <script type="text/javascript" src="$resourceBaseUri/scripts.js"></script>
    <title>Vapour Report</title>
  </head>
  <body>    
    <div class="all">
    
    #if $printForm:
    <h1>
      <a href="http://vapour.sourceforge.net/" title="go to vapour project home page">
        <abbr title="VAlidation Process Of Uri Response">vapour</abbr>
      </a>
    </h1>
    <div class="inputData">
	    <h2>Input data</h2>
	    <form action="" method="get">

          <p>
            <label title="Address of the page containing the vocabulary" for="vocabUri" class="uri">Vocabulary URI:</label>
	        <input class="uri" type="text" size="50" name="vocabUri" id="vocabUri" value="$vocabUri" />
            <span class="small">(example: <tt id="example">http://www.w3.org/2006/07/SWD/recipes/examples-20080331/example3</tt>)</span>
          </p>

          <div class="vocabularyValidationSubform">
          <!-- FIXME: this div should be visible by default only if at least one of
                   {classUri, propertyUri, instanceUri} is not empty. Otherwise, it should
                   be invisible. The user should be able to "unroll" this part of the
                   form by clicking somewhere -->  
                   
          <p>
            <!-- FIXME: we may want to add some links to this paragraph -->
            If you want to validate an RDF or OWL vocabulary or ontology, you can enter
            here the URIs of a class, a property and an instance, to have them checked
            as well as the namespace (vocabulary) URI above.
          </p>
                  
          <p>
            <label title="URI of a class in the vocabulary" for="classUri" class="uri">Class URI:</label>
	        <input class="uri" type="text" size="50" name="classUri" id="classUri" value="$classUri" />
	        #if $autodetectClassUri:
	          <input type="checkbox" name="autodetectClassUri" id="autodetectClassUri" value="1" checked="checked" />
	        #else:
	          <input type="checkbox" name="autodetectClassUri" id="autodetectClassUri" value="1" />
	        #end if
            <label for="autodetectClassUri">Autodetect if empty</label>
          </p>

          <p>
            <label title="URI of a property in the vocabulary" for="propertyUri" class="uri">Property URI:</label>
	        <input class="uri" type="text" size="50" name="propertyUri" id="propertyUri" value="$propertyUri" />
	        #if $autodetectPropertyUri:
	          <input type="checkbox" name="autodetectPropertyUri" id="autodetectPropertyUri" value="1" checked="checked" />
	        #else:
	          <input type="checkbox" name="autodetectPropertyUri" id="autodetectPropertyUri" value="1" />
	        #end if
	        <label for="autodetectPropertyUri" class="check">Autodetect if empty</label>
          </p>

          <p>
            <label title="URI of an instance in the vocabulary" for="instanceUri" class="uri">Instance URI:</label>
	        <input class="uri" type="text" size="50" name="instanceUri" id="instanceUri" value="$instanceUri" />
          </p>
          </div>

          <div class="advancedOptionsSubform">
          <!-- FIXME: this div should be visible only when at least one of the
                  checkboxes is active -->
          <p>
	        #if $validateRDF:
	          <input type="checkbox" name="validateRDF" id="validateRDF" value="1" checked="checked" />
	        #else:
	          <input type="checkbox" name="validateRDF" id="validateRDF" value="1" />
	        #end if
	        <label for="validateRDF" class="check">Validate objects' URIs in the responses</label>
          </p>

          <p>
	        #if $htmlVersions:
	          <input type="checkbox" name="htmlVersions" id="htmlVersions" value="1" checked="checked" />
	        #else:
	          <input type="checkbox" name="htmlVersions" id="htmlVersions" value="1" />
	        #end if
	        <label for="htmlVersions" class="check">There are HTML descriptions of the symbols</label>
          </p>
          
          <p>
            <!-- FIXME: this field depends on the previous checkbox (i.e.: it only makes
            sense when there are HTML descriptions of the symbols). It would be nice
            if it could be "disabled" if the checkbox above is not checked -->
            <label for="defaultResponse">Expected default response (without content negotiation)</label>
            <select name="defaultResponse" id="defaultResponse">
              <option value="rdfxml">RDF/XML</option>
              <option value="html">(X)HTML</option>
            </select>
          </p>
          </div>

	      <p class="submit"><input type="submit" value="Validate!" /></p>      

	    </form>
    </div>
    #end if
    
    #if len($testRequirements) > 0:
    <h1>Vapour Report</h1>
    <div class="summary">
      <h2>Summary</h2>
      #if $isThereAnyFailingTest:
        <p class="overallResultFail">Some tests failed!</p>
      #else:
        <p class="overallResultPass">All tests passed!</p>
      #end if
      <table class="summaryTable">
        <thead>
          <tr>
            <td>Test requirement</td>
            <td>Passed tests</td>
          </tr>
        </thead>
        <tbody>
          #for $testRequirement in $testRequirements:
          <tr>
            <td>
              <a href="#$testRequirement[0]">
              $testRequirement[1]
              </a>
             </td>
             #set $totalTests = len($testResults[$testRequirement[0]])
             #set $failedTests = len([x for x in $testResults[$testRequirement[0]] if x[3] == EARL["fail"]])
             #if $failedTests == 0:
               #set $cssClass = "allTestsOk"
             #else:
               #set $cssClass = "someTestsFail"
             #end if
            <td class="$cssClass">
            #echo ($totalTests - $failedTests)#/$totalTests
            </td>            
          </tr>
          #end for
        </tbody>
      </table>
      #if $namespaceFlavour:
        <p>It is a $namespaceFlavour['name'].</p>
      #end if
      #if len($validRecipes) > 0:
         <p>To learn more about this configuration:</p>
         <ul>
           #for $validRecipe in $validRecipes:
             <li><a href="$validRecipe['link']">$validRecipe['name']</a></li>
           #end for
         </ul>
      #end if
    </div> <!-- /summary -->

    #for $testRequirement in $testRequirements:
    <div class="testRequirement">
      <div class="httpDialog">
        <h2 id="$testRequirement[0]">
          $testRequirement[1]
         </h2>
         <div class="clientIcon">
           <img src="$resourceBaseUri/computer.png" alt="A computer on the client-side"/>
           <p>Client</p>
         </div> <!-- /clientIcon -->
         <div class="dialogArea">
	       #for $trace in $httpTraces[$testRequirement[0]]:
 	       <!-- $trace[1] -->
	       <div class="request">
	  	      <div class="requestInner">
	  	         <span class="httpHeader">GET #echo getShortFileName($trace[2])#</span>
	  	         #if $trace[10] != None:
		  	     <span class="httpHeader">Accept: $trace[10]</span>
		         #end if
	  	      </div> <!-- /requestInner -->
           </div> <!-- /request -->
	       <div class="response">
	         <div class="responseInner">
	            #if $trace[3] == 200:
                <div class="fileIcon">
		          <a href="$trace[2]">
		          #if ($trace[4].startswith(mimetypes.rdfXml)):
			        <img src="$resourceBaseUri/rdf-file.png" alt="RDF icon" />
			      #else if ($trace[4].startswith(mimetypes.html)):
			        <img src="$resourceBaseUri/html-file.png" alt="HTML icon" />
			      #else:
			        <img src="$resourceBaseUri/unknown-file.png" alt="Unknown file type icon" />
			      #end if
			      </a>
			    </div> <!-- /fileIcon -->
	            #end if
	      
                #if $trace[7] == EARL["pass"]:
                  #set $additionalCssClass = "goodHttpHeader"
			    #else if $trace[7] == EARL["fail"]:
			      #set $additionalCssClass = "badHttpHeader"
			    #else:
			      #set $additionalCssClass = ""
			    #end if
			    
                <span class="httpHeader $additionalCssClass">$trace[3]</span>
			      
			    #if $trace[3] == 200:
			      #if $trace[9] == EARL["pass"]:
			        #set $additionalCssClass = "goodHttpHeader"
			      #else if $trace[9] == EARL["fail"]:
			        #set $additionalCssClass = "badHttpHeader"
			      #else:
			        #set $additionalCssClass = ""
			      #end if	        
			      <span class="httpHeader $additionalCssClass">Content-type: $trace[4]</span>
			    #end if
			      
			    #if $trace[3] == 303 or $trace[3] == 302:
			    <span class="httpHeader">Location: $trace[5]</span>
			    #end if
	         </div> <!-- /responseInner -->
	       </div> <!-- /response -->
	       #end for
         </div> <!-- /dialogArea -->
         
         <div class="serverIcon">
		   <img src="$resourceBaseUri/apacheconf.png" alt="A web server" />
		   <p>Web server</p>
         </div>
         <div class="dummyR"></div>
      </div> <!-- /httpDialog -->

    <h3>Test results</h3>
    <ul>
	#for $test in $testResults[$testRequirement[0]]:
      #if $test[3] == EARL["pass"]:
        #set $testResultCssClass = "correctValue"
      #else
        #set $testResultCssClass = "badValue"
      #end if
	<li>
	  $test[6] ($test[2]):
	  <span class="$testResultCssClass">$test[4]</span>
	</li>
	#end for
    </ul>
    
    #if len($finalUris[$testRequirement[0]]) > 0:
    <h3>Further options</h3>
    <ul>
    #from urllib import quote
    #for $finalUri in $finalUris[$testRequirement[0]]:
      #if 'text/html' in $finalUri[1] or 'application/xhtml+xml' in $finalUri[1]:
      <li>
        <a href="http://validator.w3.org/check?uri=#echo quote($finalUri[0], '') #">
          Check the response with the W3C HTTP validator
        </a>
      </li>
      #else if  'application/rdf+xml' in $finalUri[1]:
      <li>
        <a href="http://www.w3.org/RDF/Validator/ARPServlet?URI=#echo quote($finalUri[0], '') #">
         Check the response with the W3C RDF validator
        </a>
      </li>
      <li>
        <a href="http://dataviewer.zitgist.com/?uri=#echo quote($finalUri[0], '') #">Browse the RDF data using Zitgist</a>
      </li>
      <li>
        Browse the RDF data using Disco (not available now)
      </li>
      <li>
        <a href="http://pingthesemanticweb.com/ping.php?url=#echo quote($finalUri[0], '') #">PingTheSemanticWeb</a>
      </li>
      #end if
    #end for
    </ul>
    #end if


    </div> <!-- /testRequirement -->
    #end for
    #end if

  </div> <!-- /all -->

    <div id="logo">
      <a href="http://www.fundacionctic.org/"><img src="$resourceBaseUri/images/ctic.png" width="215" height="62" alt="Fundacion CTIC" /></a>
    </div>
    
    #if len($testAgent) > 0:
    <div class="footer">
      <p>Report generated by <a href="$testAgent[3]/">$testAgent[1]</a>,
      version $testAgent[2] on ${reportDate}. Please read the
      <a href="http://www.w3.org/TR/swbp-vocab-pub/">Best Practice Recipes</a>
      document. You can also <a href="$rdfReportUrl">get an RDF version</a> of this
      report.</p>
    </div>
    #end if
    
  </body>

</html>
